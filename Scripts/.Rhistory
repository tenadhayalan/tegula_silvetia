fill = expression(paste("Temperature (",degree,"C)")),
y = expression(Shell~length~(mm)))
initialsizeplot + initialshellplot + plot_layout(guides = "collect", axes = "collect_x")
#ggsave("initial snails.png", path=here("Output"), width = 10, height = 5)
#tegrespodry$end_date <- as.Date(tegrespodry$Date, format = "%Y%m%d")
#tegrespodry$start_date <- as.Date("2025-02-17")
# calculate growth rate (change in wet weight over 28 days)
tegrespodry$growth_rate <- (tegrespodry$wet_weight - tegrespodry$initial_wet_weight) / 28 #g/d/individual
growth_model <- lm(growth_rate ~ pH + temp_treatment, data = tegrespodry)
summary(growth_model)
tegrespodry %>%
ggplot(aes(x=pH, y=growth_rate, color = as.factor(temp_treatment),fill=as.factor(temp_treatment)))+
geom_point(alpha = 0.5)+
geom_smooth(method = "lm", se = TRUE) +
theme_bw() +
theme(strip.background = element_rect(fill = "white"),
text = element_text(size = 14)) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(Growth~Rate))
## April experiment
# calculate shell growth as final - initial / initial
aprilTeg <- aprilTeg %>%
filter(!is.na(shell_length_mm) & shell_length_mm != 0) %>%  # remove NAs
mutate(shell_length_growth = (shell_length2 - shell_length_mm) / shell_length_mm)
# model against ph and temp
shell_length_model <- lm(shell_length_growth ~ pH * factor(temp), data = aprilTeg)
anova(shell_length_model) # pH significant
# model with averages
# calculate averages
aprilTeg_avg <- aprilTeg %>%
group_by(pH, temp) %>%  # group by temp and pH
summarize(
avg_lgrowth_rate = mean(shell_length_growth, na.rm = TRUE)  # calculate mean growth rate
)
# average model
april_lgrowth_model <- lm(avg_lgrowth_rate ~ pH * factor(temp), data = aprilTeg_avg)
anova(april_lgrowth_model) # pH significant
# visualize
aprilTeg %>%
filter(!is.na(temp)) %>%
ggplot(aes(x=pH, y=shell_length_growth, color = as.factor(temp)))+
geom_point(alpha = 0.5)+
geom_smooth(method = "lm", se = TRUE) +
theme_bw() +
theme(strip.background = element_rect(fill = "white"),
text = element_text(size = 14)) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(April~Shell~Length~Growth))
# calculate change in shell width
aprilTeg <- aprilTeg %>%
filter(!is.na(shell_width_mm) & shell_width_mm != 0) %>%  # remove NAs
mutate(shell_width_growth = (shell_width2 - shell_width_mm) / shell_width_mm)
# calculate averages
aprilTeg_avg <- aprilTeg %>%
group_by(pH, temp) %>%  # group by temp and pH
summarize(
avg_wgrowth_rate = mean(shell_width_growth, na.rm = TRUE)  # calculate mean growth rate
)
# model against ph and temp
shell_width_model <- lm(shell_width_growth ~ pH * factor(temp), data = aprilTeg)
anova(shell_width_model) # pH significant
# avg model
april_wgrowth_model <- lm(avg_wgrowth_rate ~ pH * factor(temp), data = aprilTeg_avg)
summary(april_wgrowth_model) # not significant
#visualize
aprilTeg %>%
filter(!is.na(temp)) %>%
ggplot(aes(x=pH, y=shell_width_growth, color = as.factor(temp)))+
geom_point(alpha = 0.5)+
geom_smooth(method = "lm", se = TRUE) +
theme_bw() +
theme(strip.background = element_rect(fill = "white"),
text = element_text(size = 14)) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(April~Shell~Width~Growth))
## May experiment
# calculate shell growth as final - initial / initial
mayTeg <- mayTeg %>%
filter(!is.na(shell_length_mm) & shell_length_mm != 0) %>%  # remove NAs
mutate(shell_length_growth = (shell_length2 - shell_length_mm) / shell_length_mm)
# model against ph and temp
shell_length_model <- lm(shell_length_growth ~ pH * temp, data = mayTeg)
anova(shell_length_model) # nothing significant
# model with averages
# calculate averages
mayTeg_avg <- mayTeg %>%
group_by(pH, temp) %>%  # group by temp and pH
summarize(
avg_lgrowth_rate = mean(shell_length_growth, na.rm = TRUE)  # calculate mean growth rate
)
# average model
may_lgrowth_model <- lm(avg_lgrowth_rate ~ pH * factor(temp), data = mayTeg_avg)
anova(may_lgrowth_model) # not significant
# visualize
mayTeg %>%
filter(!is.na(temp)) %>%
ggplot(aes(x=pH, y=shell_length_growth, color = as.factor(temp)))+
geom_point(alpha = 0.5)+
geom_smooth(method = "lm", se = TRUE) +
theme_bw() +
theme(strip.background = element_rect(fill = "white"),
text = element_text(size = 14)) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(May~Shell~Length~Growth))
# calculate change in shell width
mayTeg <- mayTeg %>%
filter(!is.na(shell_width_mm) & shell_width_mm != 0) %>%  # remove NAs
mutate(shell_width_growth = (shell_width2 - shell_width_mm) / shell_width_mm)
# calculate averages
mayTeg_avg <- mayTeg %>%
group_by(pH, temp) %>%  # group by temp and pH
summarize(
avg_wgrowth_rate = mean(shell_width_growth, na.rm = TRUE)  # calculate mean growth rate
)
# model against ph and temp
shell_width_model <- lm(shell_width_growth ~ pH * factor(temp), data = mayTeg)
anova(shell_width_model) # nothing significant
# avg model
may_wgrowth_model <- lm(avg_wgrowth_rate ~ pH * factor(temp), data = mayTeg_avg)
summary(may_wgrowth_model) # not significant
#visualize
mayTeg %>%
filter(!is.na(temp)) %>%
ggplot(aes(x=pH, y=shell_width_growth, color = as.factor(temp)))+
geom_point(alpha = 0.5)+
geom_smooth(method = "lm", se = TRUE) +
theme_bw() +
theme(strip.background = element_rect(fill = "white"),
text = element_text(size = 14)) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(May~Shell~Width~Growth))
# calculate condition index
tegrespodry$CI <- tegrespodry$dry_weight/tegrespodry$dry_shell_weight*100
# model April
condition_index_model_a <- lm(CI ~ pH * temp_treatment, data = (tegrespodry %>% filter(experiment == "a")))
anova(condition_index_model_a) # pH is significant, increases with pH
tegrespodry %>% filter(experiment == "a") %>%
ggplot(aes(x=pH, y=CI, color = as.factor(temp_treatment),fill=as.factor(temp_treatment)))+
facet_wrap(~experiment,labeller = as_labeller(c("a" = "April", "b" = "May")))+
geom_point(alpha = 0.5)+
geom_smooth(method = "lm", se = TRUE) +
theme_bw() +
theme(strip.background = element_rect(fill = "white"),
text = element_text(size = 14)) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(Condition~Index))
# model May
condition_index_model_b <- lm(CI ~ pH * temp_treatment, data = (tegrespodry %>% filter(experiment == "b")))
anova(condition_index_model_b) # not significant
tegrespodry %>% filter(experiment == "b") %>%
ggplot(aes(x=pH, y=CI, color = as.factor(temp_treatment),fill=as.factor(temp_treatment)))+
facet_wrap(~experiment,labeller = as_labeller(c("a" = "April", "b" = "May")))+
geom_point(alpha = 0.5)+
geom_smooth(method = "lm", se = TRUE) +
theme_bw() +
theme(strip.background = element_rect(fill = "white"),
text = element_text(size = 14)) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(Condition~Index))
tegrespo_avg <- tegrespodry %>%
group_by(pH, temp_treatment, experiment) %>%  # group by temp and pH
summarize(
avg_res = mean(Respiration, na.rm = TRUE)  # calculate mean respo rate
)
summary(tegrespodry)
# find averages by temperature to calculate % increase
tegrespo_avgrates <- tegrespo_avg %>%
group_by(experiment, temp_treatment) %>%
summarise(
mean_respo = mean(avg_res, na.rm = TRUE)
)
# avg models
avg_res_model <- lm(avg_res ~ pH * temp_treatment * experiment, data = tegrespo_avg)
anova(avg_res_model)
summary(avg_res_model)
# april avg model
avg_res_model_april <- lm(avg_res ~ pH * temp_treatment, data = tegrespo_avg %>% filter(experiment == "a"))
anova(avg_res_model_april) # nothing sig
summary(avg_res_model_april)
# may avg model
avg_res_model_may <- lm(avg_res ~ pH * temp_treatment, data = tegrespo_avg %>% filter(experiment == "b"))
anova(avg_res_model_may) # temp sig
summary(avg_res_model_may)
# avg plot
# predict using model
tegrespodry <- tegrespodry %>%
mutate(predicted_res = predict(avg_res_model, newdata = tegrespodry))
predictions <- predict(avg_res_model, newdata = tegrespodry, interval = "confidence")
# Add predictions and confidence intervals to calc_new
tegrespodry <- tegrespodry %>%
mutate(predicted_res = predictions[, "fit"],
lower_ci = predictions[, "lwr"],  # Lower confidence bound
upper_ci = predictions[, "upr"])  # Upper confidence bound
# avg plot
avgtegrespoplot <-
tegrespodry %>%
ggplot(aes(x = pH, y = Respiration, color = as.factor(temp_treatment), fill = as.factor(temp_treatment))) +
facet_wrap(~experiment, labeller = as_labeller(c("a" = "Early spring", "b" = "Late spring"))) +
geom_point(alpha = 0.1) + # raw data
geom_ribbon(aes(ymin = lower_ci, ymax = upper_ci, fill = as.factor(temp_treatment)), alpha = 0.3, color = NA) + # confidence interval
geom_point(data = tegrespo_avg, aes(y = avg_res),
color = "black", size = 2, alpha = 0.8, shape = 21) +
geom_line(aes(y = predicted_res), size = 1.2) + # add model line
theme_bw() +
theme(strip.background = element_rect(fill = "white"),
text = element_text(size = 14)) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(Respiration~rate~(mu*mol~O[2]~g^-1~hr^-1)))
tegrespo_avg <- tegrespo_avg %>%
ungroup() %>%
mutate(temp_num = as.numeric(as.character(temp_treatment))) %>% # make temp a number
mutate(pH_scale = as.numeric(scale(pH)), # scale the values so that you can calculated standardized effects
temp_scale = as.numeric(scale(temp_num)))
# April - run your model on the scaled data for april
tegmodel_res_april <- lm(avg_res ~ pH_scale * temp_scale, data=tegrespo_avg %>% filter(experiment == "a"))
#plot(tegmodel_res_april)
anova(tegmodel_res_april) # nothing sig
summary(tegmodel_res_april)
# May - again in may
tegmodel_res_may <- lm(avg_res ~ pH_scale * temp_scale, data=tegrespo_avg %>% filter(experiment == "b"))
#plot(tegmodel_res)
anova(tegmodel_res_may) # temp sig
summary(tegmodel_res_may)
### Extract the standardized effect sizes using the effectsize function from emmeans
std_coefs<-as_tibble(effectsize(tegmodel_res_april)) %>% # get the effect sizes for april
mutate(month = "Early spring") %>% # add the season
left_join(tidy(tegmodel_res_april) %>%
dplyr::select(Parameter = term, p.value)) %>% # bring in the p-values from the summary of the model
bind_rows(as_tibble(effectsize(tegmodel_res_may)) %>% # bind it to the same for May
mutate(month = "Late spring") %>%
left_join(tidy(tegmodel_res_may) %>%
dplyr::select(Parameter = term, p.value))) %>%
filter(Parameter != "(Intercept)") %>% # remove the intercepts for the STD Coef plot
mutate(Parameter = case_when(Parameter == "temp_scale" ~"Temperature",
Parameter == "pH_scale" ~"pH",
Parameter == "pH_scale:temp_scale"~"pH:Temperature")) %>% # make names prettier
mutate(Parameter = factor(Parameter, levels = c("pH:Temperature","Temperature","pH"))) %>% # put it in the order I want
mutate(significant = ifelse(p.value < 0.055, 1, 0.2)) # change the alpha of points that are not significant
# make a standardized effects plot
tegrespoplot <-
std_coefs %>%
ggplot(aes(x = Std_Coefficient, y = Parameter, color = month, alpha = significant))+
geom_vline(xintercept = 0, lty = 3)+
geom_point(size = 3,
position = position_dodge(width = 0.2))+ # offset the points a little bit so not on top of each other by month
geom_errorbarh(aes(xmin = CI_low, xmax = CI_high),
height = 0.1, position = position_dodge(width = 0.2))+
labs(x = "Standardized Effect Size \n Respiration",
y = "",
color = "")+
scale_color_manual(values = c("#540D6E", "#0EAD69"))+
scale_alpha(range = c(0.3,1))+
guides(alpha = "none")+ # don't show the alpha legend
theme_bw()+
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.text = element_text(size = 12))
# bring in metadata
calc_new <- calc %>%
mutate(ID = as.factor(ID)) %>%
left_join(Teg.Sample.Info.New %>%
dplyr::select(ID,pH,experiment)) %>%
mutate(temp_treatment = as.factor(temp_treatment)) %>%
mutate(experiment = as.factor(experiment))
# calculate averages
calc_avg <- calc_new %>%
group_by(pH, temp_treatment, experiment) %>%  # group by temp and pH
summarize(
avg_calc = mean(umol.cm2.hr, na.rm = TRUE)  # calculate mean calc rate
)
# find averages by temperature to calculate % increase
calc_avgrates <- calc_avg %>%
group_by(experiment, temp_treatment) %>%
summarise(
mean_calc = mean(avg_calc, na.rm = TRUE)
)
# find averages by pH to calculate % increase
calc_avgrates <- calc_avg %>%
group_by(experiment, pH) %>%
summarise(
mean_calc = mean(avg_calc, na.rm = TRUE)
)
# april avg model
avg_calc_model_april <- lm(avg_calc ~ pH * temp_treatment, data = calc_avg %>% filter(experiment == "a"))
anova(avg_calc_model_april) # nothing sig
summary(avg_calc_model_april)
# may avg model
avg_calc_model_may <- lm(avg_calc ~ pH * temp_treatment, data = calc_avg %>% filter(experiment == "b"))
anova(avg_calc_model_may) # pH and temp sig
summary(avg_calc_model_may)
# avg model altogether
avg_calc_model <- lm(avg_calc ~ pH * temp_treatment * experiment, data = calc_avg)
anova(avg_calc_model) # ph x exp, temp x exp
summary(avg_calc_model)
# without outliers
calc_out <- calc_new %>%
filter(!deltaTA > mean(deltaTA, na.rm = TRUE) + 3 * sd(deltaTA, na.rm = TRUE))
# calculate averages without outliers
calc_avg_out <- calc_out %>%
group_by(pH, temp_treatment, experiment) %>%  # group by temp and pH
summarize(
avg_calc = mean(umol.cm2.hr, na.rm = TRUE)  # calculate mean calc rate
)
# april avg model
avg_calc_model_april <- lm(avg_calc ~ pH * temp_treatment, data = calc_avg_out %>% filter(experiment == "a"))
anova(avg_calc_model_april) # nothing sig
summary(avg_calc_model_april)
# may avg model
avg_calc_model_may <- lm(avg_calc ~ pH * temp_treatment, data = calc_avg_out %>% filter(experiment == "b"))
anova(avg_calc_model_may) # pH and temp sig
summary(avg_calc_model_may)
# avg model altogether
avg_calc_model <- lm(avg_calc ~ pH * temp_treatment * experiment, data = calc_avg_out)
anova(avg_calc_model) # ph x exp, temp x exp
summary(avg_calc_model)
# avg plot
# predict using model
calc_new <- calc_new %>%
mutate(predicted_calc = predict(avg_calc_model, newdata = calc_new))
predictions <- predict(avg_calc_model, newdata = calc_new, interval = "confidence")
# Add predictions and confidence intervals to calc_new
calc_new <- calc_new %>%
mutate(predicted_calc = predictions[, "fit"],
lower_ci = predictions[, "lwr"],  # Lower confidence bound
upper_ci = predictions[, "upr"])  # Upper confidence bound
# avg plot
avgcalcplot <-
calc_new %>%
ggplot(aes(x = pH, y = umol.cm2.hr, color = as.factor(temp_treatment), fill = as.factor(temp_treatment))) +
facet_wrap(~experiment, labeller = as_labeller(c("a" = "Early spring", "b" = "Late spring"))) +
geom_point(alpha = 0.1) + # raw data
geom_ribbon(aes(ymin = lower_ci, ymax = upper_ci, fill = as.factor(temp_treatment)), alpha = 0.3, color = NA) + # confidence interval
geom_point(data = calc_avg, aes(y = avg_calc),
color = "black", size = 2, alpha = 0.8, shape = 21) +
geom_line(aes(y = predicted_calc), size = 1.2) + # add model line
theme_bw() +
theme(strip.background = element_rect(fill = "white"),
text = element_text(size = 14)) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(Calcification~rate~(mu*mol~CaCO[3]~g^-1~hr^-1)))
shellcalc %>%
ggplot(aes(x=pH_treatment, y=umol.cm2.hr, color = as.factor(temp_treatment),fill=as.factor(temp_treatment)))+
geom_point(alpha = 0.2)+
#geom_smooth(method = "lm", se = TRUE) +
theme_bw() +
theme(strip.background = element_rect(fill = "white"),
text = element_text(size = 16)) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(Calcification~rate~(mu*mol~CaCO[3]~hr^-1)))
calc_avg<-calc_avg %>%
ungroup() %>%
mutate(temp_num = as.numeric(as.character(temp_treatment))) %>% # make temp a number
mutate(pH_scale = as.numeric(scale(pH)), # scale the values so that you can calculated standardized effects
temp_scale = as.numeric(scale(temp_num)))
# April - run your model on the scaled data for april
tegmodel_cal_april <- lm(avg_calc ~ pH_scale * temp_scale, data=calc_avg %>% filter(experiment == "a"))
#plot(tegmodel_res)
anova(tegmodel_cal_april) # nothing sig
summary(tegmodel_cal_april)
# May - again in may
tegmodel_cal_may <- lm(avg_calc ~ pH_scale * temp_scale, data=calc_avg %>% filter(experiment == "b"))
#plot(tegmodel_res)
anova(tegmodel_cal_may) # ph and temp sig
summary(tegmodel_cal_may)
### Extract the standardized effect sizes using the effectsize function from emmeans (this is using cohens_d, I believe, which scales everything on 0 - 1)
std_coefs<-as_tibble(effectsize(tegmodel_cal_april)) %>% # get the effect sizes for april
mutate(month = "Early spring") %>% # add the month
left_join(tidy(tegmodel_cal_april) %>%
dplyr::select(Parameter = term, p.value)) %>% # bring in the p-values from the summary of the model (which is now correct now that the values are standardized -- Note you STILL report the ANOVA results when talking about your significance in the model.  These p-values essentially tell you if the values are different or not from your intercept (essentiall 0))
bind_rows(as_tibble(effectsize(tegmodel_cal_may)) %>% # bind it to the same for May
mutate(month = "Late spring") %>%
left_join(tidy(tegmodel_cal_may) %>%
dplyr::select(Parameter = term, p.value))) %>%
filter(Parameter != "(Intercept)") %>% # remove the intercepts for the STD Coef plot
mutate(Parameter = case_when(Parameter == "temp_scale" ~"Temperature",
Parameter == "pH_scale" ~"pH",
Parameter == "pH_scale:temp_scale"~"pH:Temperature")) %>% # make names prettier
mutate(Parameter = factor(Parameter, levels = c("pH:Temperature","Temperature","pH"))) %>% # put it in the order I want
mutate(significant = ifelse(p.value < 0.055, 1, 0.2)) # use this to change the alpha of points that are not significant
# make a standardized effects plot. You will eventually bring these different ones together in patchwork like we talked about in person
tegcalcplot <-
std_coefs %>%
ggplot(aes(x = Std_Coefficient, y = Parameter, color = month, alpha = significant))+
geom_vline(xintercept = 0, lty = 3)+
geom_point(size = 3,
position = position_dodge(width = 0.2))+ # offset the points a little bit so not on top of eachother by month
geom_errorbarh(aes(xmin = CI_low, xmax = CI_high),
height = 0.1, position = position_dodge(width = 0.2))+
labs(x = "Standardized Effect Size \n Calcification",
y = "",
color = "")+
scale_alpha(range = c(0.3,1))+
scale_color_manual(values = c("#540D6E", "#0EAD69"))+
guides(alpha = "none")+ # don't show the alpha legend
theme_bw()+
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.text = element_text(size = 12))
rwrespo <- respo_dry_clean %>%
filter(Species == "Rockweed", Respiration != 0) # filter out snails
RW.Sample.Info.New <- Sample.Info.New %>%
filter(Species == "Rockweed", BLANK == "0") # filter out snails
rwrespo$ID <- as.factor(rwrespo$ID)
rwrespo <- rwrespo %>%
left_join(RW.Sample.Info.New %>% dplyr::select(pH, experiment, ID) %>%
distinct(experiment, ID, .keep_all = TRUE), by = c("experiment","ID")) # bring in sample info
rwrespo_clean <- rwrespo %>%
filter(!is.na(Respiration) & !is.nan(Respiration) & !is.infinite(Respiration)) # get rid of any NAs
rwrespo_clean <- rwrespo_clean %>% filter(NetPhoto > 0) # get rid of outliers
rwrespo_clean <- rwrespo_clean %>%
mutate(temp_treatment = as.factor(temp_treatment), experiment = as.factor(experiment)) # make factors
## averages for control and consumer cages
rwrespo_avg_p <- rwrespo_clean %>%
group_by(pH, temp_treatment, experiment, predator) %>%  # group for herbivore vs control per tank
summarize(
avg_gp = mean(GrossPhoto, na.rm = TRUE)  # calculate mean gp rate
)
# april
rwmodelGP_Pa <- lm(avg_gp ~ pH * temp_treatment * predator, data=rwrespo_avg_p %>% filter(experiment == "a"))
#plot(rwmodelGP_Pa)
anova(rwmodelGP_Pa) #model stats, pH sig
summary(rwmodelGP_Pa)
# may
rwmodelGP_Pb <- lm(avg_gp ~ pH * temp_treatment * predator, data=rwrespo_avg_p %>% filter(experiment == "b"))
anova(rwmodelGP_Pb) #model stats, pH sig, temp:predator sig
summary(rwmodelGP_Pb)
# how much larger was GP at 20?
rwrespo_avg_p %>%
filter(experiment == "b") %>%
group_by(temp_treatment, predator) %>%
summarize(mean(avg_gp))
# predict using model
rwrespo_clean <- rwrespo_clean %>%
mutate(predicted_gp = predict(rwmodelGP_Pb, newdata = rwrespo_clean))
predictions <- predict(rwmodelGP_Pb, newdata = rwrespo_clean, interval = "confidence")
# add predictions and confidence intervals to calc_new
rwrespo_clean <- rwrespo_clean %>%
mutate(predicted_gp = predictions[, "fit"],
lower_ci = predictions[, "lwr"],  # Lower confidence bound
upper_ci = predictions[, "upr"])  # Upper confidence bound
rwrespo_clean %>%
filter(experiment == "b") %>%
ggplot(aes(x = pH, y = GrossPhoto, color = as.factor(temp_treatment),
fill = as.factor(temp_treatment))) +
facet_wrap(~predator, labeller = as_labeller(c("p" = "Consumer present", "c" = "Consumer absent"))) +
geom_point(alpha = 0.1)+ # raw data
geom_ribbon(aes(ymin = lower_ci, ymax = upper_ci, fill = as.factor(temp_treatment)), alpha = 0.3, color = NA) + # confidence interval
geom_point(data = rwrespo_avg_p, aes(y = avg_gp),
color = "black", size = 2, alpha = 0.8, shape = 21) +
geom_line(aes(y = predicted_gp), size = 1.2) +
theme_bw()+
theme(
strip.background = element_rect(fill = "white"),
text = element_text(size = 14)
) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(
x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(Gross~photosynthetic~rate~(mu*mol~O[2]~g^-1~hr^-1)))
#ggsave("predation response.png", path = here("Output"), width = 8, height = 7)
rwrespo_avg <- rwrespo_avg %>%
ungroup() %>%
mutate(temp_num = as.numeric(as.character(temp_treatment))) %>% # make temp a number
mutate(pH_scale = as.numeric(scale(pH)), # scale the values so that you can calculated standardized effects
temp_scale = as.numeric(scale(temp_num)))
anova(avg_res_model_may) # temp sig
summary(avg_res_model_may)
anova(avg_calc_model_may) # pH and temp sig
summary(avg_calc_model_may)
