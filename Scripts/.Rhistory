geom_point(data = rwrespo_avg_p, aes(y = avg_gp),
color = "black", size = 2, alpha = 0.8, shape = 21) +
geom_line(aes(y = predicted_gp), size = 1.2) +
theme_bw()+
theme(
strip.background = element_rect(fill = "white"),
text = element_text(size = 14)
) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(
x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(Gross~photosynthetic~rate~(mu*mol~O[2]~g^-1~hr^-1)))
#ggsave("predation response.png", path = here("Output"), width = 8, height = 7)
rwrespo_avg <- rwrespo_clean %>%
group_by(pH, temp_treatment, experiment) %>%
summarize(
avg_gp = mean(GrossPhoto, na.rm = TRUE)  # calculate mean gp rate
) %>%
ungroup() %>%
mutate(temp_num = as.numeric(as.character(temp_treatment))) %>% # make temp a number
mutate(pH_scale = as.numeric(scale(pH)), # scale the values so that you can calculated standardized effects
temp_scale = as.numeric(scale(temp_num)))
# April - run your model on the scaled data for april
rwmodel_gp_april <- lm(avg_gp ~ pH_scale * temp_scale, data=rwrespo_avg %>% filter(experiment == "a"))
#plot(tegmodel_res)
anova(rwmodel_gp_april) # pH sig
summary(rwmodel_gp_april)
# May - again in may
rwmodel_gp_may <- lm(avg_gp ~ pH_scale * temp_scale, data=rwrespo_avg %>% filter(experiment == "b"))
#plot(tegmodel_res)
anova(rwmodel_gp_may) # pH sig
summary(rwmodel_gp_may)
### Extract the standardized effect sizes using the effectsize function from emmeans
std_coefs<-as_tibble(effectsize(rwmodel_gp_april)) %>% # get the effect sizes for april
mutate(month = "Early spring") %>% # add the month
left_join(tidy(rwmodel_gp_april) %>%
dplyr::select(Parameter = term, p.value)) %>% # bring in the p-values from the summary of the model
bind_rows(as_tibble(effectsize(rwmodel_gp_may)) %>% # bind it to the same for May
mutate(month = "Late spring") %>%
left_join(tidy(rwmodel_gp_may) %>%
dplyr::select(Parameter = term, p.value))) %>%
filter(Parameter != "(Intercept)") %>% # remove the intercepts for the STD Coef plot
mutate(Parameter = case_when(Parameter == "temp_scale" ~"Temperature",
Parameter == "pH_scale" ~"pH",
Parameter == "pH_scale:temp_scale"~"pH:Temperature")) %>% # make names prettier
mutate(Parameter = factor(Parameter, levels = c("pH:Temperature","Temperature","pH"))) %>% # put it in the order I want
mutate(significant = ifelse(p.value < 0.055, 1, 0.5)) # use this to change the alpha of points that are not significant
# make a standardized effects plot
rwgpplot <-
std_coefs %>%
ggplot(aes(x = Std_Coefficient, y = Parameter, color = month, alpha = significant))+
geom_vline(xintercept = 0, lty = 3)+
geom_point(size = 3,
position = position_dodge(width = 0.2))+ # offset the points a little bit so not on top of eachother by month
geom_errorbarh(aes(xmin = CI_low, xmax = CI_high),
height = 0.1, position = position_dodge(width = 0.2))+
labs(x = "Standardized Effect Size \n Gross Photosynthesis",
y = "",
color = "")+
scale_alpha(range = c(0.3,1))+
scale_color_manual(values = c("#540D6E", "#0EAD69"))+
guides(alpha = "none")+ # don't show the alpha legend
theme_bw()+
theme(axis.title = element_text(size = 14),# neeg ggtext loaded for this to work
axis.text = element_text(size = 12),
legend.text = element_text(size = 12))
# patchwork guide = collect to show one legend
summary(rwrespo_clean)
# ok what if we averaged
rwrespo_avg <- rwrespo_clean %>%
group_by(pH, temp_treatment, experiment) %>%  # group by temp and pH
summarize(
avg_gp = mean(GrossPhoto, na.rm = TRUE)  # calculate mean gp rate
)
# getting temp diff
rwrespoavgavg <- rwrespo_avg %>%
filter(experiment == "b") %>%
group_by(temp_treatment) %>%
summarize (avg_gp_temp = mean(avg_gp, na.rm = TRUE))
# avg model
avg_gp_model <- lm(avg_gp ~ pH * temp_treatment * experiment, data = rwrespo_avg)
anova(avg_gp_model) # exp, ph x exp sig
summary(avg_gp_model)
# avg plot
# predict using model
rwrespo_clean <- rwrespo_clean %>%
mutate(predicted_gp = predict(avg_gp_model, newdata = rwrespo_clean))
predictions <- predict(avg_gp_model, newdata = rwrespo_clean, interval = "confidence")
# Add predictions and confidence intervals to calc_new
rwrespo_clean <- rwrespo_clean %>%
mutate(predicted_gp = predictions[, "fit"],
lower_ci = predictions[, "lwr"],  # Lower confidence bound
upper_ci = predictions[, "upr"])  # Upper confidence bound
# avg plot
avggpplot <-
rwrespo_clean %>%
ggplot(aes(x = pH, y = GrossPhoto, color = as.factor(temp_treatment), fill = as.factor(temp_treatment))) +
facet_wrap(~experiment, labeller = as_labeller(c("a" = "Early spring", "b" = "Late spring"))) +
geom_point(alpha = 0.1) + # raw data
geom_ribbon(aes(ymin = lower_ci, ymax = upper_ci, fill = as.factor(temp_treatment)), alpha = 0.3, color = NA) + # confidence interval
geom_point(data = rwrespo_avg, aes(y = avg_gp),
color = "black", size = 2, alpha = 0.8, shape = 21) +
geom_line(aes(y = predicted_gp), size = 1.2) + # add model line
theme_bw() +
theme(strip.background = element_rect(fill = "white"),
text = element_text(size = 14)) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(Gross~Photo~rate~(mu*mol~O[2]~g^-1~hr^-1)))
rwrespo_avg_p <- rwrespo_clean %>%
group_by(pH, temp_treatment, experiment, predator) %>%  # group for predator vs control per tank
summarize(
avg_gp = mean(GrossPhoto, na.rm = TRUE),  # calculate mean GP rate
avg_respo = mean(Respiration, na.rm = TRUE)
)
rwrespo_avg_p <- rwrespo_avg_p %>%
ungroup() %>%
mutate(temp_num = as.numeric(as.character(temp_treatment))) %>% # make temp a number
mutate(pH_scale = as.numeric(scale(pH)), # scale the values so that you can calculated standardized effects
temp_scale = as.numeric(scale(temp_num)))
# April - run your model on the scaled data for april
rwmodel_gp_april <- lm(avg_gp ~ pH_scale * temp_scale * predator, data=rwrespo_avg_p %>% filter(experiment == "a"))
#plot(tegmodel_res)
anova(rwmodel_gp_april) # pH sig
summary(rwmodel_gp_april)
# May - again in may
rwmodel_gp_may <- lm(avg_gp ~ pH_scale * temp_scale * predator, data=rwrespo_avg_p %>% filter(experiment == "b"))
#plot(tegmodel_res)
anova(rwmodel_gp_may) # pH sig, temp:predator sig
summary(rwmodel_gp_may)
### Extract the standardized effect sizes using the effectsize function from emmeans
std_coefs<-as_tibble(effectsize(rwmodel_gp_april)) %>% # get the effect sizes for april
mutate(month = "Early spring") %>% # add the month
left_join(tidy(rwmodel_gp_april) %>%
dplyr::select(Parameter = term, p.value)) %>% # bring in the p-values from the summary of the model
bind_rows(as_tibble(effectsize(rwmodel_gp_may)) %>% # bind it to the same for May
mutate(month = "Late spring") %>%
left_join(tidy(rwmodel_gp_may) %>%
dplyr::select(Parameter = term, p.value))) %>%
filter(Parameter != "(Intercept)") %>% # remove the intercepts for the STD Coef plot
mutate(Parameter = case_when(Parameter == "temp_scale" ~"Temperature",
Parameter == "pH_scale" ~"pH",
Parameter == "predatorp" ~"Consumer",
Parameter == "pH_scale:temp_scale" ~"pH:Temperature",
Parameter == "pH_scale:predatorp" ~"pH:Consumer",
Parameter == "temp_scale:predatorp" ~"Temperature:Consumer",
Parameter == "pH_scale:temp_scale:predatorp" ~
"Temperature:pH:Consumer"
)) %>% # make names prettier
mutate(Parameter = factor(Parameter, levels = c("Temperature:pH:Consumer","pH:Consumer",
"Temperature:Consumer", "pH:Temperature",
"Consumer","Temperature","pH"))) %>%
# put it in the order I want
mutate(significant = ifelse(p.value < 0.055, 1, 0.5)) # use this to change the alpha of points that are not significant
# make a standardized effects plot
rwgppredplot <-
std_coefs %>%
ggplot(aes(x = Std_Coefficient, y = Parameter, color = month, alpha = significant))+
geom_vline(xintercept = 0, lty = 3)+
geom_point(size = 3,
position = position_dodge(width = 0.2))+ # offset the points a little bit so not on top of eachother by month
geom_errorbarh(aes(xmin = CI_low, xmax = CI_high),
height = 0.1, position = position_dodge(width = 0.2))+
labs(x = "Standardized Effect Size \n Gross Photosynthesis",
y = "",
color = "")+
scale_alpha(range = c(0.3,1))+
scale_color_manual(values = c("#540D6E", "#0EAD69"))+
guides(alpha = "none")+ # don't show the alpha legend
theme_bw()+
theme(axis.title = element_text(size = 14),# neeg ggtext loaded for this to work
axis.text = element_text(size = 12),
legend.text = element_text(size = 12))
# calculate averages
rwrespo_avg_p <- rwrespo_clean %>%
group_by(pH, temp_treatment, experiment, predator) %>%  # group by temp and pH
summarize(
avg_respo = mean(Respiration, na.rm = TRUE)  # calculate mean calc rate
)
# avg model april
avg_respo_model_april <- lm(avg_respo ~ pH * temp_treatment * predator, data = rwrespo_avg_p %>% filter(experiment == "a"))
anova(avg_respo_model_april) # ph x temp sig
summary(avg_respo_model_april)
# avg model may
avg_respo_model_may <- lm(avg_respo ~ pH * temp_treatment * predator, data = rwrespo_avg_p %>% filter(experiment == "b"))
anova(avg_respo_model_may) # nothing
summary(avg_respo_model_may)
# avg model for plot
avg_respo_model <- lm(avg_respo ~ pH * temp_treatment * experiment, data = rwrespo_avg_p)
anova(avg_respo_model) # temp sig
summary(avg_respo_model)
# predict using model
rwrespo_clean_plot <- rwrespo_clean %>%
mutate(predicted_respo = predict(avg_respo_model, newdata = rwrespo_clean))
predictions <- predict(avg_respo_model, newdata = rwrespo_clean_plot, interval = "confidence")
# Add predictions and confidence intervals to calc_new
rwrespo_clean_plot <- rwrespo_clean %>%
mutate(predicted_respo = predictions[, "fit"],
lower_ci = predictions[, "lwr"],  # Lower confidence bound
upper_ci = predictions[, "upr"])  # Upper confidence bound
# avg plot
avgrwrespoplot <-
rwrespo_clean_plot %>%
ggplot(aes(x = pH, y = Respiration, color = as.factor(temp_treatment), fill = as.factor(temp_treatment))) +
facet_wrap(~experiment, labeller = as_labeller(c("a" = "Early spring", "b" = "Late spring"))) +
geom_point(alpha = 0.1) + # raw data
geom_ribbon(aes(ymin = lower_ci, ymax = upper_ci, fill = as.factor(temp_treatment)), alpha = 0.3, color = NA) + # confidence interval
geom_point(data = rwrespo_avg_p, aes(y = avg_respo),
color = "black", size = 2, alpha = 0.8, shape = 21) +
geom_line(aes(y = predicted_respo), size = 1.2) + # add model line
theme_bw() +
theme(strip.background = element_rect(fill = "white"),
text = element_text(size = 14)) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(Respiration~rate~(mu*mol~O[2]~g^-1~hr^-1)))
rwrespo_avg <- rwrespo_clean %>%
group_by(pH, temp_treatment, experiment) %>%  # group by temp and pH
summarize(
avg_respo = mean(Respiration, na.rm = TRUE)  # calculate mean calc rate
) %>%
ungroup() %>%
mutate(temp_num = as.numeric(as.character(temp_treatment))) %>% # make temp a number
mutate(pH_scale = as.numeric(scale(pH)), # scale the values so that you can calculated standardized effects
temp_scale = as.numeric(scale(temp_num)))
# April - run your model on the scaled data for april
rwmodel_res_april <- lm(avg_respo ~ pH_scale * temp_scale, data=rwrespo_avg %>% filter(experiment == "a"))
#plot(tegmodel_res)
anova(rwmodel_res_april) # ph x temp sig
summary(rwmodel_res_april)
# May - again in may
rwmodel_res_may <- lm(avg_respo ~ pH_scale * temp_scale, data=rwrespo_avg %>% filter(experiment == "b"))
#plot(tegmodel_res)
anova(rwmodel_res_may) # nothing sig
summary(rwmodel_res_may)
### Extract the standardized effect sizes using the effectsize function from emmeans (this is using cohens_d, I believe, which scales everything on 0 - 1)
std_coefs<-as_tibble(effectsize(rwmodel_res_april)) %>% # get the effect sizes for april
mutate(month = "Early spring") %>% # add the month
left_join(tidy(rwmodel_res_april) %>%
dplyr::select(Parameter = term, p.value)) %>% # bring in the p-values from the summary of the model (which is now correct now that the values are standardized -- Note you STILL report the ANOVA results when talking about your significance in the model.  These p-values essentially tell you if the values are different or not from your intercept (essentiall 0))
bind_rows(as_tibble(effectsize(rwmodel_res_may)) %>% # bind it to the same for May
mutate(month = "Late spring") %>%
left_join(tidy(rwmodel_res_may) %>%
dplyr::select(Parameter = term, p.value))) %>%
filter(Parameter != "(Intercept)") %>% # remove the intercepts for the STD Coef plot
mutate(Parameter = case_when(Parameter == "temp_scale" ~"Temperature",
Parameter == "pH_scale" ~"pH",
Parameter == "pH_scale:temp_scale"~"pH:Temperature")) %>% # make names prettier
mutate(Parameter = factor(Parameter, levels = c("pH:Temperature","Temperature","pH"))) %>% # put it in the order I want
mutate(significant = ifelse(p.value < 0.055, 1, 0.5)) # use this to change the alpha of points that are not significant
# make a standardized effects plot. You will eventually bring these different ones together in patchwork like we talked about in person
rwrespoplot <-
std_coefs %>%
ggplot(aes(x = Std_Coefficient, y = Parameter, color = month, alpha = significant))+
geom_vline(xintercept = 0, lty = 3)+
geom_point(size = 3,
position = position_dodge(width = 0.2))+ # offset the points a little bit so not on top of eachother by month
geom_errorbarh(aes(xmin = CI_low, xmax = CI_high),
height = 0.1, position = position_dodge(width = 0.2))+
labs(x = "Standardized Effect Size \n Respiration",
y = "",
color = "")+
scale_alpha(range = c(0.3,1))+
scale_color_manual(values = c("#540D6E", "#0EAD69"))+
guides(alpha = "none")+ # don't show the alpha legend
theme_bw()+
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.text = element_text(size = 12))
rwrespo_avg_p <- rwrespo_clean %>%
group_by(pH, temp_treatment, experiment, predator) %>%  # group for consumer vs control per tank
summarize(
avg_gp = mean(GrossPhoto, na.rm = TRUE),  # calculate mean GP rate
avg_respo = mean(Respiration, na.rm = TRUE)
)
rwrespo_avg_p <- rwrespo_avg_p %>%
ungroup() %>%
mutate(temp_num = as.numeric(as.character(temp_treatment))) %>% # make temp a number
mutate(pH_scale = as.numeric(scale(pH)), # scale the values so that you can calculated standardized effects
temp_scale = as.numeric(scale(temp_num)))
# April - run your model on the scaled data for april
rwmodel_resp_april <- lm(avg_respo ~ pH_scale * temp_scale * predator, data=rwrespo_avg_p %>% filter(experiment == "a"))
#plot(tegmodel_res)
anova(rwmodel_gp_april) # pH sig
summary(rwmodel_gp_april)
# May - again in may
rwmodel_resp_may <- lm(avg_respo ~ pH_scale * temp_scale * predator, data=rwrespo_avg_p %>% filter(experiment == "b"))
#plot(tegmodel_res)
anova(rwmodel_gp_may) # pH sig, temp:predator sig
summary(rwmodel_gp_may)
### Extract the standardized effect sizes using the effectsize function from emmeans
std_coefs<-as_tibble(effectsize(rwmodel_resp_april)) %>% # get the effect sizes for april
mutate(month = "Early spring") %>% # add the month
left_join(tidy(rwmodel_resp_april) %>%
dplyr::select(Parameter = term, p.value)) %>% # bring in the p-values from the summary of the model (which is now correct now that the values are standardized -- Note you STILL report the ANOVA results when talking about your significance in the model.  These p-values essentially tell you if the values are different or not from your intercept (essentiall 0))
bind_rows(as_tibble(effectsize(rwmodel_resp_may)) %>% # bind it to the same for May
mutate(month = "Late spring") %>%
left_join(tidy(rwmodel_resp_may) %>%
dplyr::select(Parameter = term, p.value))) %>%
filter(Parameter != "(Intercept)") %>% # remove the intercepts for the STD Coef plot
mutate(Parameter = case_when(Parameter == "temp_scale" ~"Temperature",
Parameter == "pH_scale" ~"pH",
Parameter == "predatorp" ~"Consumer",
Parameter == "pH_scale:temp_scale" ~"pH:Temperature",
Parameter == "pH_scale:predatorp" ~"pH:Consumer",
Parameter == "temp_scale:predatorp" ~"Temperature:Consumer",
Parameter == "pH_scale:temp_scale:predatorp" ~
"Temperature:pH:Consumer"
)) %>% # make names prettier
mutate(Parameter = factor(Parameter, levels = c("Temperature:pH:Consumer","pH:Consumer",
"Temperature:Consumer", "pH:Temperature",
"Consumer","Temperature","pH"))) %>%
# put it in the order I want
mutate(significant = ifelse(p.value < 0.055, 1, 0.5)) # use this to change the alpha of points that are not significant
# make a standardized effects plot. You will eventually bring these different ones together in patchwork like we talked about in person
rwrespopredplot <-
std_coefs %>%
ggplot(aes(x = Std_Coefficient, y = Parameter, color = month, alpha = significant))+
geom_vline(xintercept = 0, lty = 3)+
geom_point(size = 3,
position = position_dodge(width = 0.2))+ # offset the points a little bit so not on top of eachother by month
geom_errorbarh(aes(xmin = CI_low, xmax = CI_high),
height = 0.1, position = position_dodge(width = 0.2))+
labs(x = "Standardized Effect Size \n Respiration",
y = "",
color = "")+
scale_alpha(range = c(0.3,1))+
scale_color_manual(values = c("#540D6E", "#0EAD69"))+
guides(alpha = "none")+ # don't show the alpha legend
theme_bw()+
theme(axis.title = element_text(size = 14),# neeg ggtext loaded for this to work
axis.text = element_text(size = 12),
legend.text = element_text(size = 12))
# patchwork guide = collect to show one legend
# standardized effect size response plots
rwrespoplot + rwgpplot + tegrespoplot + tegcalcplot + plot_layout(guides = "collect", axes = "collect")
# raw response plots
avgrwrespoplot <-
avgrwrespoplot +
scale_x_continuous(breaks = c(7.2, 7.6, 8.0))+
labs(y = expression(atop(Respiration~rate,(mu*mol~O[2]~g^-1~hr^-1))))
avggpplot <-
avggpplot +
scale_x_continuous(breaks = c(7.2, 7.6, 8.0))+
labs(y = expression(atop(Gross~photosynthetic~rate,(mu*mol~O[2]~g^-1~hr^-1))))
avgtegrespoplot <-
avgtegrespoplot +
scale_x_continuous(breaks = c(7.2, 7.6, 8.0))+
labs(y = expression(atop(Respiration~rate,(mu*mol~O[2]~g^-1~hr^-1))))
avgcalcplot <-
avgcalcplot +
scale_x_continuous(breaks = c(7.2, 7.6, 8.0))+
labs(y = expression(atop(Calcification~rate,(mu*mol~CaCO[3]~g^-1~hr^-1))))
avgrwrespoplot + avggpplot + avgtegrespoplot + avgcalcplot + plot_layout(guides = "collect", axes = "collect_x")
#ggsave("raw responses.png", path=here("Output"), width = 10, height = 8)
rwrespopredplot+ rwgppredplot + plot_layout(guides="collect", axes = "collect_y")
#ggsave("predator effect size plots.png", path=here("Output"), width = 10, height = 4)
anova(avg_calc_model_april) # nothing sig
# calculate averages
calc_avg <- calc_new %>%
group_by(pH, temp_treatment, experiment) %>%  # group by temp and pH
summarize(
avg_calc = mean(umol.cm2.hr, na.rm = TRUE)  # calculate mean calc rate
)
# find averages by temperature to calculate % increase
calc_avgrates <- calc_avg %>%
group_by(experiment, temp_treatment) %>%
summarise(
mean_calc = mean(avg_calc, na.rm = TRUE)
)
# find averages by pH to calculate % increase
calc_avgrates <- calc_avg %>%
group_by(experiment, pH) %>%
summarise(
mean_calc = mean(avg_calc, na.rm = TRUE)
)
# april avg model
avg_calc_model_april <- lm(avg_calc ~ pH * temp_treatment, data = calc_avg %>% filter(experiment == "a"))
anova(avg_calc_model_april) # nothing sig
summary(avg_calc_model_april)
# may avg model
avg_calc_model_may <- lm(avg_calc ~ pH * temp_treatment, data = calc_avg %>% filter(experiment == "b"))
anova(avg_calc_model_may) # pH and temp sig
summary(avg_calc_model_may)
# avg model altogether
avg_calc_model <- lm(avg_calc ~ pH * temp_treatment * experiment, data = calc_avg)
anova(avg_calc_model) # ph x exp, temp x exp
summary(avg_calc_model)
# avg plot
# predict using model
calc_new <- calc_new %>%
mutate(predicted_calc = predict(avg_calc_model, newdata = calc_new))
predictions <- predict(avg_calc_model, newdata = calc_new, interval = "confidence")
# Add predictions and confidence intervals to calc_new
calc_new <- calc_new %>%
mutate(predicted_calc = predictions[, "fit"],
lower_ci = predictions[, "lwr"],  # Lower confidence bound
upper_ci = predictions[, "upr"])  # Upper confidence bound
# avg plot
avgcalcplot <-
calc_new %>%
ggplot(aes(x = pH, y = umol.cm2.hr, color = as.factor(temp_treatment), fill = as.factor(temp_treatment))) +
facet_wrap(~experiment, labeller = as_labeller(c("a" = "Early spring", "b" = "Late spring"))) +
geom_point(alpha = 0.1) + # raw data
geom_ribbon(aes(ymin = lower_ci, ymax = upper_ci, fill = as.factor(temp_treatment)), alpha = 0.3, color = NA) + # confidence interval
geom_point(data = calc_avg, aes(y = avg_calc),
color = "black", size = 2, alpha = 0.8, shape = 21) +
geom_line(aes(y = predicted_calc), size = 1.2) + # add model line
theme_bw() +
theme(strip.background = element_rect(fill = "white"),
text = element_text(size = 14)) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(Calcification~rate~(mu*mol~CaCO[3]~g^-1~hr^-1)))
# calculate averages
calc_avg <- calc_new %>%
group_by(pH, temp_treatment, experiment) %>%  # group by temp and pH
summarize(
avg_calc = mean(umol.cm2.hr, na.rm = TRUE)  # calculate mean calc rate
)
# find averages by temperature to calculate % increase
calc_avgrates <- calc_avg %>%
group_by(experiment, temp_treatment) %>%
summarise(
mean_calc = mean(avg_calc, na.rm = TRUE)
)
# find averages by pH to calculate % increase
calc_avgrates <- calc_avg %>%
group_by(experiment, pH) %>%
summarise(
mean_calc = mean(avg_calc, na.rm = TRUE)
)
# april avg model
avg_calc_model_april <- lm(avg_calc ~ pH * temp_treatment, data = calc_avg %>% filter(experiment == "a"))
anova(avg_calc_model_april) # nothing sig
summary(avg_calc_model_april)
# may avg model
avg_calc_model_may <- lm(avg_calc ~ pH * temp_treatment, data = calc_avg %>% filter(experiment == "b"))
anova(avg_calc_model_may) # pH and temp sig
summary(avg_calc_model_may)
# avg model altogether
avg_calc_model <- lm(avg_calc ~ pH * temp_treatment * experiment, data = calc_avg)
anova(avg_calc_model) # ph x exp, temp x exp
summary(avg_calc_model)
# avg plot
# predict using model
calc_new <- calc_new %>%
mutate(predicted_calc = predict(avg_calc_model, newdata = calc_new))
predictions <- predict(avg_calc_model, newdata = calc_new, interval = "confidence")
# Add predictions and confidence intervals to calc_new
calc_new <- calc_new %>%
mutate(predicted_calc = predictions[, "fit"],
lower_ci = predictions[, "lwr"],  # Lower confidence bound
upper_ci = predictions[, "upr"])  # Upper confidence bound
# avg plot
avgcalcplot <-
calc_new %>%
ggplot(aes(x = pH, y = umol.cm2.hr, color = as.factor(temp_treatment), fill = as.factor(temp_treatment))) +
facet_wrap(~experiment, labeller = as_labeller(c("a" = "Early spring", "b" = "Late spring"))) +
geom_point(alpha = 0.1) + # raw data
geom_ribbon(aes(ymin = lower_ci, ymax = upper_ci, fill = as.factor(temp_treatment)), alpha = 0.3, color = NA) + # confidence interval
geom_point(data = calc_avg, aes(y = avg_calc),
color = "black", size = 2, alpha = 0.8, shape = 21) +
geom_line(aes(y = predicted_calc), size = 1.2) + # add model line
theme_bw() +
theme(strip.background = element_rect(fill = "white"),
text = element_text(size = 14)) +
scale_fill_manual(values = c("skyblue2", "firebrick1")) +
scale_color_manual(values = c("skyblue2", "firebrick1")) +
labs(x = expression(pH[T]),
color = expression(paste("Temperature (",degree,"C)")),
fill = expression(paste("Temperature (",degree,"C)")),
y = expression(Calcification~rate~(mu*mol~CaCO[3]~g^-1~hr^-1)))
anova(avg_calc_model_april) # nothing sig
anova(avg_calc_model) # ph x exp, temp x exp
anova(avg_calc_model_may) # pH and temp sig
anova(avg_calc_model_april) # nothing sig
summary(avg_calc_model_april)
anova(avg_calc_model_may) # pH and temp sig
summary(avg_calc_model_may)
#plot(rwmodelGP_Pa)
anova(rwmodelGP_Pa) #model stats, pH sig
summary(rwmodelGP_Pa)
summary(rwmodelGP_Pb)
anova(avg_respo_model_april) # ph x temp sig
summary(avg_respo_model_april)
summary(avg_respo_model_may)
# scale up to m
tegfield <- tegfield %>%
mutate(teg_density_m = total...eiseni * 4)
# create density plot
tegfield %>%
ggplot(aes(x = 0, y = teg_density_m)) +
geom_dotplot(binaxis='y', stackdir='center', alpha = 0.1)+
theme_bw()+
stat_summary(fun.data=mean_se, fun.args = list(mult=1), geom="pointrange", color="black", size = 1)+
labs(y = expression(paste("Snail density m" ^ "-2")))+
theme(axis.title = element_text(size = 22), axis.text = element_text(size = 18),
axis.text.x = element_blank(),
axis.title.x = element_blank())
